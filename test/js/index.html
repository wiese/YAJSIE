<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<title>jsI18n demo</title>
		<script type="text/javascript" src="../../vendor/prototype/prototype.js"></script>
		<script type="text/javascript" src="../../lib/YAJSIE.js"></script>
		<script type="text/javascript"  src="../../vendor/jsunit/app/jsUnitCore.js"></script>
		<script type="text/javascript">
			var YAJSIE_data = {
				'de_DE' : {
					"pluralForms": "nplurals=2; plural=n != 1;",
					"template": {
						"pattern": /(^|.|\r|\n)(#(\w+)#)/
					},
					"translations": {
						"first": "erster",
						"second ": "zweiter ",
						"  third": "  dritter",
						"i am #name#": "ich bin #name#",
						"another #n# times": {
							"msgid_plural": "one more time",
							"msgstr[0]": "noch einmal",
							"msgstr[1]": "noch #n# mal"
						}
					}
				},
				'ru_RU' : {
					"pluralForms": "nplurals=3; plural=n%10==1 && n%100!=11 ? 0 : n%10>=2 && n%10<=4 && (n%100<10 || n%100>=20) ? 1 : 2;",
					"template": {
						"pattern": /(^|.|\r|\n)(#(\w+)#)/
					},
					"translations": {
						"File": {
							"msgid_plural": "Files",
							"msgstr[0]": "Файл",
							"msgstr[1]": "Файла",
							"msgstr[2]": "Файлов"
						}
					}
				}
			};
		</script>
		<script type="text/javascript"><!--

			var testsuite = new top.jsUnitTestSuite();

			function testTest() {
				assertEquals("it's alive", 1, 1);
			}

			function testConfigObject() {
				try {
					var i18n = new YAJSIE();
					fail("Unexpected success creating YAJSIE with empty config");
				}
				catch(e) {
					var expected =
						new Error('You have to define at least the locale information');
					assertEquals(expected.toString(), 'Error: '+e.toString());
				}
			}

			function testSigular() {
				var i18n = new YAJSIE({locale: 'de_DE', variable: 'YAJSIE_data'});
				assertEquals("erster", i18n._("first"));
				assertEquals("zweiter ", i18n._("second "));
				assertEquals("  dritter", i18n._("  third"));
			}

			function testSingularReplacement() {
				var i18n = new YAJSIE({locale: 'de_DE', variable: 'YAJSIE_data'});
				assertEquals(
					"ich bin peter",
					i18n._("i am #name#", {'name': 'peter'})
				);
			}

			function testOriginalFallback() {
				var i18n = new YAJSIE({locale: 'de_DE', variable: 'YAJSIE_data'});
				var translation;
				try {
					translation = i18n._("not in translations");
					console.log('blubb');
				}
				catch (e) {
					console.log(e);
					//assertEquals("not in translations", exceptionText);
				}
				assertEquals("not in translations", translation);
			}

			function testPlural() {
				var i18n = new YAJSIE({locale: 'de_DE', variable: 'YAJSIE_data'});
				assertEquals(
					'noch einmal',
					i18n._n("another #n# times", "one more time", 1, {n: 1})
				);
			}

			function testPluralReplacement() {
				var i18n = new YAJSIE({locale: 'de_DE', variable: 'YAJSIE_data'});
				assertEquals(
					'noch 3 mal',
					i18n._n("another #n# times", "one more time", 3, {n: 3})
				);
			}

			function testSetLocale() {
				var i18n = new YAJSIE({locale: 'de_DE', variable: 'YAJSIE_data'});
				try {
					i18n.setLocale('lorem');
					fail("Unexpected success setting undefined locale setting");
				}
				catch(e) {
					var expected =
						new Error("The required locale setting 'lorem' is not available.");
					assertEquals(expected.toString(), 'Error: '+e.toString());
				}
			}

			function testComplexPluralForms() {
				var i18n = new YAJSIE({locale: 'ru_RU', variable: 'YAJSIE_data'});
				assertEquals("Файл", i18n._("File"));
				assertEquals("Файл", i18n._n("File", "Files", 1));
				assertEquals("Файла", i18n._n("File", "Files", 2));
				assertEquals("Файлов", i18n._n("File", "Files", 10));
			}

		--></script>
	</head>
	<body>
		<p>jsI18n tests</p>
	</body>
</html>
